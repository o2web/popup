!function(p){p(document).ready(function(){function e(p){return p.stopPropagation(),p.preventDefault(),!1}function o(e){var o=e[0].popup;popup.current.$loader=o.loader?o.loader:popup.$loader,popup.current.$closeButton=o.closeButton?o.closeButton:popup.$closeButton,popup.current.messages=p.extend(!0,popup.messages,o.messages),popup.current.$loader.html(popup.current.messages),popup.current.$closeButton.html(popup.current.messages.close),popup.current.$closeButton.on("click",c),popup.$popup.prepend(popup.current.$loader),popup.$popup.append(popup.current.$closeButton),popup.$page.append(popup.$popup)}function r(){popup.$popup.remove().html(""),popup.current={}}function u(p){$win.on("scroll",e),$children=popup.$page.children(),popup.scrolled=$win.scrollTop(),popup.$page.prepend(popup.$freezed),popup.$freezed.append($children),popup.$freezed[0].scrollTop=popup.scrolled,o(p)}function t(p){$children=popup.$freezed.children(),r(p),$children.eq(0).unwrap(),$win[0].scrollTo(0,popup.scrolled),$win.off("scroll",e)}function n(e){var o=e[0].popup,r=e.attr("href");return r?(o.endpoint&&(r+=o.endpoint),void(popup.req=p.ajax({url:r,success:function(p){popup.req=void 0,popup.current.$loader.remove(),popup.$popup.append(p)},error:function(){popup.req=void 0,popup.current.$loader.remove(),popup.current.$error=o.error?o.error:popup.$error,popup.current.$error.html(popup.current.messages.error),popup.$popup.append(popup.current.$error)}}))):!1}function i(p){var e=p[0].popup.type;return e?void("ajax"==e&&n(p)):!1}function s(e){var o=p(this),r=o[0].popup;popup.current.$trigger=o,"function"==typeof r.beforeInit&&r.beforeInit(r),u(o),i(o),"function"==typeof r.afterInit&&r.afterInit(r),e.stopPropagation(),e.preventDefault()}function c(e){var o=p(this),r=popup.current.$trigger[0].popup;popup.req&&popup.req.abort(),"function"==typeof r.beforeClose&&r.beforeClose(r),t(o),"function"==typeof r.afterClose&&r.afterClose(r),e.stopPropagation(),e.preventDefault()}function d(){}window.popup={items:[],scrolled:0,req:void 0,current:{},$page:p("body"),$loader:p('<div class="loader"></div>'),$popup:p('<div class="popup"></div>'),$freezed:p('<div class="freezed"></div>'),$closeButton:p('<button class="close"></button>'),$error:p('<div class="error message"><div>'),messages:{close:"Fermer",loading:"Chargement",error:"Une erreur est survenue"}},popup.$freezed.css({position:"fixed",top:0,left:0,zIndex:-1,width:"100%",height:"100%",overflow:"hidden"}),popup.$popup.css({position:"relative",minHeight:"100%",zIndex:1,overflow:"auto"}),p.fn.popup=function(e,o){var r=p(this),u=typeof e;if("string"==u)return d(e,o),r;for(var t=0;t<r.length;t++){var n=p(r[t]),i={type:"ajax",endpoint:void 0,messages:{},closeButton:void 0,loader:void 0,beforeInit:void 0,afterInit:void 0,beforeClose:void 0,afterClose:void 0};p.extend(i,e);var u=n.attr("popup");"undefined"!=typeof u&&u&&(i.type=u),n[0].popup=n[0].popup?i:p.extend(n[0].popup,i),window.popup.items.push(n[0])}r.on("click",s)}})}(jQuery);