!function(p,o){"function"==typeof define&&define.amd?define(["jquery"],o):o(jQuery)}(this,function(p){function o(p){return p.stopPropagation(),p.preventDefault(),!1}function e(p){p.stopPropagation()}function r(){$.onpopstate=void 0,popup.popped=!0,l()}function t(o){var e=o[0].popup;popup.current.$loader=e.loader?e.loader:popup.$loader,popup.current.$closeButton=e.closeButton?e.closeButton:popup.$closeButton,popup.current.messages=p.extend(!0,popup.messages,e.messages),popup.current.$loader.html(popup.current.messages.loading),popup.current.$closeButton.html(popup.current.messages.close),popup.current.$closeButton.on("click",l),popup.$popup.prepend(popup.current.$loader),popup.$popup.append(popup.current.$closeButton),popup.$page.append(popup.$popup)}function u(){popup.$popup.remove().html(""),popup.current={}}function n(p){$win.on("scroll",o),$children=popup.$page.children(),popup.scrolled=$win.scrollTop(),popup.$page.prepend(popup.$freezed),popup.$freezed.append($children),popup.$freezed[0].scrollTop=popup.scrolled,t(p),popup.$doc.addClass("has-popup")}function i(p){popup.$doc.removeClass("has-popup"),$children=popup.$freezed.children(),u(p),$children.eq(0).unwrap(),$win[0].scrollTo(0,popup.scrolled),$win.off("scroll",o)}function c(o){var r=o[0].popup,t=o.attr("form"==r.type?"action":"href");if(!t)return!1;r.endpoint&&(t+=r.endpoint);var u={url:t,success:function(o){if(popup.req=void 0,popup.current.$loader.remove(),popup.current.$data=p(o),"function"==typeof r.onSuccess){var t=r.onSuccess(popup.current.$data);if(t===!1)return;t instanceof p&&(popup.current.$data=t)}popup.$popup.append(popup.current.$data),popup.current.$data.on("click",e),popup.$popup.on("click",l)},error:function(){popup.req=void 0,popup.current.$loader.remove(),popup.current.$error=r.error?r.error:popup.$error,popup.current.$error.html(popup.current.messages.error),popup.$popup.append(popup.current.$error),"function"==typeof r.onError&&r.onError(popup.current.$error)}};"form"==r.type&&(u.type="post",u.data=o.serialize()),popup.req=p.ajax(u)}function a(o){var r=(o[0].popup,o.attr("popup-content"));return r?(popup.current.$loader.remove(),popup.current.$data=p(r),popup.$popup.append(popup.current.$data),popup.current.$data.on("click",e),void popup.$popup.on("click",l)):!1}function s(p){var o=p[0].popup.type;return o?void("ajax"==o?c(p):"attr"==o?a(p):"form"==o&&c(p)):!1}function d(o){var e=p(this),t=e[0].popup;popup.current.$trigger=e,popup.current.settings=t,"function"==typeof t.beforeInit&&t.beforeInit(t),popup.historyEnabled&&($.history.pushState({},"popup","#!/popup"),$.onpopstate=r),n(e),s(e),"function"==typeof t.afterInit&&t.afterInit(t),o&&o.stopPropagation&&(o.stopPropagation(),o.preventDefault())}function l(p){var o=popup.current.$trigger,e=popup.current.settings;popup.req&&popup.req.abort(),"function"==typeof e.beforeClose&&e.beforeClose(e),i(o),popup.historyEnabled&&!popup.popped&&($.onpopstate=void 0,popup.popped=void 0,$.history.go(-1)),popup.$popup.off("click",l),"function"==typeof e.afterClose&&e.afterClose(e),p&&p.stopPropagation&&(p.stopPropagation(),p.preventDefault())}function f(p){"close"==p&&l()}var $=this;$.popup={items:[],scrolled:0,req:void 0,historyEnabled:void 0!=$.history.length,current:{},$doc:p(document.documentElement),$page:p(document.body),$loader:p('<div class="loader"></div>'),$popup:p('<div class="popup"></div>'),$freezed:p('<div class="freezed"></div>'),$closeButton:p('<button class="close"></button>'),$error:p('<div class="error message"><div>'),messages:{close:"Fermer",loading:"Chargement",error:"Une erreur est survenue"}},popup.$freezed.css({position:"fixed",top:0,left:0,zIndex:-1,width:"100%",height:"100%",overflow:"hidden"}),popup.$popup.css({position:"relative",minHeight:"100%",zIndex:1,overflow:"auto"}),p.fn.popup=function(o,e){var r=p(this),t=typeof o;if("string"==t)return f(o,e),r;for(var u=0;u<r.length;u++){var n=p(r[u]),i={type:"ajax",endpoint:void 0,messages:{},closeButton:void 0,loader:void 0,beforeInit:void 0,afterInit:void 0,onSuccess:void 0,onError:void 0,beforeClose:void 0,afterClose:void 0};p.extend(i,o);var t=n.attr("popup");"undefined"!=typeof t&&t&&(i.type=t),n[0].popup=n[0].popup?i:p.extend(n[0].popup,i),$.popup.items.push(n[0]),"form"==t?n.on("submit",d):n.on("click",d)}}});