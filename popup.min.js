// popup.js
// o2web.ca
jQuery(document).ready(function(a){var b=function(){var a=window.getComputedStyle(document.documentElement,""),b=(Array.prototype.slice.call(a).join("").match(/-(moz|webkit|ms)-/)||""===a.OLink&&["","o"])[1],c="WebKit|Moz|MS|O".match(new RegExp("("+b+")","i"))[1];return{dom:c,lowercase:b,css:"-"+b+"-",js:(b[0].toUpperCase()+b.substr(1)).toLowerCase()}}(),c=function(){var a,b=!1,c=["Webkit","Moz","ms","O"],d=document.createElement("div");if(void 0!==d.style.perspective)a="",b=!0;else for(var e=0;e<c.length;++e)if(c[e]+"Perspective"in d.style){b=!0,a=c[e];break}return b}();b.js+"Transition";var e=b.js+"Transform";b.css+"transform";var g=b.css+"transition",h={start:"translate"+(c?"3d":""),end:c?", 0":""};a.extend(a.fn,{popup:function(b){var c=a(this);c.each(function(){var c=a(this)[0]?a(this)[0]:this;c.s={},a.extend(c.s,a.extend(!0,{types:{def:{content:"body",ajax:!0,initCallback:null,closeCallback:null,overlay:{color:"#000",image:null,opacity:.8},slide:!0}},zIndex:25,duration:500,easeIn:"swing",easeOut:"swing",cssEaseIn:"cubic-bezier(0.65, 0, 0.75, 0.4)",cssEaseOut:"cubic-bezier(0.275, 0.895, 0.51, 1)",text:{loading:"Loading...",closePopup:"Close"}},b))}),a(this).on("click",function(b){var c=a(this)[0]?a(this)[0]:this,d=a(this).attr("href"),f=c.s.types[a(this).attr("popup")]?a(this).attr("popup"):"def",i=a.extend(!0,c.s.types.def,c.s.types[f]),j={scroll:{x:a(window).scrollLeft(),y:a(window).scrollTop()},overflow:a("body")[0].style.overflow};a("body").append('<div id="popup"><div class="overlay"></div><div class="close">'+c.s.text.closePopup+"</div></div>");var k=a("#popup").addClass(f).fadeTo(0,0).css({position:"fixed",top:0,bottom:0,left:0,right:0,overflow:"hidden",zIndex:c.s.zIndex}),l=a(".overlay",k).css({position:"fixed",top:0,bottom:0,left:0,right:0,background:(i.overlay.image?image+" ":"")+i.overlay.color,zIndex:0}).fadeTo(0,i.overlay.opacity);a("body").css({overflow:"hidden",height:a(window).height()+"px"}).prepend('<div class="freezed"></div>').children().not(k).appendTo(a("body>.freezed"));var m=a("body>.freezed").css({marginTop:"-"+j.scroll.y+"px"});window.scrollTo(0,0),a(k).append('<div class="loader">'+c.s.text.loading+"</div>").fadeTo(c.s.duration,1,c.s.easing);var p,n=a(".loader",k).css({position:"absolute",left:"50%",top:"50%",zIndex:3,margin:"-"+a(this).height()/2+"px -"+a(this).width()/2+"px"}),o=null,q=!1,t=a(".close",k).css({zIndex:2}).hide();if(i.ajax)var u=a.get(d,function(b){p=a(b).find(i.content),a(k).append('<div class="popup-content white"></div>'),o=a(".popup-content",k).css({position:"relative",zIndex:3}).fadeTo(0,0).append(a(t).show()).append(p).fadeTo(c.s.duration,1,c.s.easeOut),i.slide&&(a(o)[0].style[e]=h.start+"(0px,-1000px"+h.end+")"),i.initCallback&&i.initCallback(c),a(n).fadeTo(c.s.duration,0,c.s.easeOut,function(){a(this).remove()}),i.slide?(a(o).css(g,"all "+(c.s.duration+100)+"ms "+c.s.cssEaseOut),a(o)[0].style[e]=h.start+"(0px,0px"+h.end+")",setTimeout(function(){a(o).css(g,""),a(o)[0].style[e]=""},c.s.duration+100)):a(k).css("overflow","auto")});else{switch(typeof i.content){case"string":p=a(i.content),q=!0;break;case"object":i.content.attr&&(p=a(c).attr(i.content.attr)),i.content.sibling&&(p=a(a(c).siblings(i.content.sibling+"")),q=!0)}a(k).append('<div class="popup-content white"></div>'),a(k).css("overflow","hidden"),o=a(".popup-content",k).css({position:"relative",zIndex:3}).fadeTo(0,0).append(a(t).show()),q&&(o.p=p.parent(),o.i=p.index()),i.slide&&(a(o)[0].style[e]=h.start+"(0px, -1000px"+h.end+")"),o.append(a(p).show()).fadeTo(c.s.duration,1,c.s.easeOut),a(n).fadeTo(c.s.duration,0,c.s.easeOut,function(){a(this).remove()}),i.slide?(a(o).css(g,"all "+(c.s.duration+100)+"ms "+c.s.cssEaseOut),a(o)[0].style[e]=h.start+"(0px,0px"+h.end+")",setTimeout(function(){a(o).css(g,""),a(o)[0].style[e]="",a(k).css("overflow","auto"),i.initCallback&&i.initCallback(c)},c.s.duration+100)):(a(k).css("overflow","auto"),i.initCallback&&i.initCallback(c))}return a(l).add(t).on("click",function(){a(l).add(t).off("click"),u&&u.abort(),i.slide&&(a(o)[0].style[e]=h.start+"(0px,0px"+h.end+")"),i.closeCallback&&i.closeCallback(c),a("body")[0].style.height=null,a("body")[0].style.overflow=null,a("body").css({overflow:"originalProps.overflow",height:null}),a(m).children().first().unwrap(),window.scrollTo(j.scroll.x,j.scroll.y),o&&(i.slide?(a(k).css("overflow","hidden").fadeTo(c.s.duration,0,c.s.easing),a(o).css(g,"all "+(c.s.duration+100)+"ms "+c.s.cssEaseIn),a(o)[0].style[e]=h.start+"(0px,-1000px"+h.end+")",setTimeout(function(){a(o).css(g,""),a(o)[0].style[e]="",!i.ajax&&q&&(0==o.i?a(o.p).prepend(a(p)):a(o.p).children().eq(o.i-1).after(a(p.hide()))),a(l).add(t).off("click"),a(k).remove()},c.s.duration+100)):a(k).css("overflow","hidden").fadeTo(c.s.duration,0,c.s.easing,function(){!i.ajax&&q&&(0==o.i?a(o.p).prepend(a(p)):a(o.p).children().eq(o.i-1).after(a(p.hide()))),a(l).add(t).off("click"),a(k).remove()}))}),b.stopPropagation(),b.preventDefault(),!1})}})});