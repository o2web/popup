!function(p){p(document).ready(function(){function o(p){return p.stopPropagation(),p.preventDefault(),!1}function e(){window.onpopstate=void 0,popup.popped=!0,c()}function r(o){var e=o[0].popup;popup.current.$loader=e.loader?e.loader:popup.$loader,popup.current.$closeButton=e.closeButton?e.closeButton:popup.$closeButton,popup.current.messages=p.extend(!0,popup.messages,e.messages),popup.current.$loader.html(popup.current.messages.loading),popup.current.$closeButton.html(popup.current.messages.close),popup.current.$closeButton.on("click",c),popup.$popup.prepend(popup.current.$loader),popup.$popup.append(popup.current.$closeButton),popup.$page.append(popup.$popup)}function t(){popup.$popup.remove().html(""),popup.current={}}function n(p){$win.on("scroll",o),$children=popup.$page.children(),popup.scrolled=$win.scrollTop(),popup.$page.prepend(popup.$freezed),popup.$freezed.append($children),popup.$freezed[0].scrollTop=popup.scrolled,r(p)}function u(p){$children=popup.$freezed.children(),t(p),$children.eq(0).unwrap(),$win[0].scrollTo(0,popup.scrolled),$win.off("scroll",o)}function i(e){var r=e[0].popup,t=e.attr("href");return t?(r.endpoint&&(t+=r.endpoint),void(popup.req=p.ajax({url:t,success:function(e){popup.req=void 0,popup.current.$loader.remove(),popup.current.$data=p(e),popup.$popup.append(popup.current.$data),popup.current.$data.on("click",o),popup.$popup.on("click",c)},error:function(){popup.req=void 0,popup.current.$loader.remove(),popup.current.$error=r.error?r.error:popup.$error,popup.current.$error.html(popup.current.messages.error),popup.$popup.append(popup.current.$error)}}))):!1}function s(p){var o=p[0].popup.type;return o?void("ajax"==o&&i(p)):!1}function d(o){var r=p(this),t=r[0].popup;popup.current.$trigger=r,popup.current.settings=t,"function"==typeof t.beforeInit&&t.beforeInit(t),popup.historyEnabled&&(window.history.pushState({},"popup","#!/detail"),window.onpopstate=e),n(r),s(r),"function"==typeof t.afterInit&&t.afterInit(t),o.stopPropagation(),o.preventDefault()}function c(p){var o=popup.current.$trigger,e=popup.current.settings;popup.req&&popup.req.abort(),"function"==typeof e.beforeClose&&e.beforeClose(e),u(o),popup.historyEnabled&&!popup.popped&&(window.onpopstate=void 0,popup.popped=void 0,window.history.go(-1)),popup.$popup.off("click",c),"function"==typeof e.afterClose&&e.afterClose(e),p.stopPropagation(),p.preventDefault()}function a(){}window.popup={items:[],scrolled:0,req:void 0,historyEnabled:void 0!=window.history.length,current:{},$page:p("body"),$loader:p('<div class="loader"></div>'),$popup:p('<div class="popup"></div>'),$freezed:p('<div class="freezed"></div>'),$closeButton:p('<button class="close"></button>'),$error:p('<div class="error message"><div>'),messages:{close:"Fermer",loading:"Chargement",error:"Une erreur est survenue"}},popup.$freezed.css({position:"fixed",top:0,left:0,zIndex:-1,width:"100%",height:"100%",overflow:"hidden"}),popup.$popup.css({position:"relative",minHeight:"100%",zIndex:1,overflow:"auto"}),p.fn.popup=function(o,e){var r=p(this),t=typeof o;if("string"==t)return a(o,e),r;for(var n=0;n<r.length;n++){var u=p(r[n]),i={type:"ajax",endpoint:void 0,messages:{},closeButton:void 0,loader:void 0,beforeInit:void 0,afterInit:void 0,beforeClose:void 0,afterClose:void 0};p.extend(i,o);var t=u.attr("popup");"undefined"!=typeof t&&t&&(i.type=t),u[0].popup=u[0].popup?i:p.extend(u[0].popup,i),window.popup.items.push(u[0])}r.on("click",d)}})}(jQuery);