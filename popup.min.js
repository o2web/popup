// popup.js
// o2web.ca
jQuery(document).ready(function(e){e.extend(e.fn,{popup:function(o){var t=e.extend(!0,{types:{def:{content:"body",ajax:!0,initCallback:null,closeCallback:null,overlay:{color:"#000",image:null,opacity:.8}}},zIndex:25,duration:500,easeIn:"swing",easeOut:"swing",text:{loading:"Loading...",closePopup:"Close"}},o)
e(this).on("click",function(o){var n=this,a=e(this).attr("href"),i=t.types[e(this).attr("popup")]?e(this).attr("popup"):"def",d=e.extend(!0,t.types.def,t.types[i]),l={scroll:{x:e(window).scrollLeft(),y:e(window).scrollTop()},overflow:e("body")[0].style.overflow}
e("body").append('<div id="popup"><div class="overlay"></div><div class="close">'+t.text.closePopup+"</div></div>")
var r=e("#popup").fadeTo(0,0).css({position:"fixed",top:0,bottom:0,left:0,right:0,overflow:"auto",zIndex:t.zIndex}),s=e(".overlay",r).css({position:"fixed",top:0,bottom:0,left:0,right:0,background:(d.overlay.image?image+" ":"")+d.overlay.color,zIndex:0}).fadeTo(0,d.overlay.opacity)
e("body").css({overflow:"hidden",height:e(window).height()+"px"}).prepend('<div class="freezed"></div>').children().not(r).appendTo(e("body>.freezed"))
var p=e("body>.freezed").css({marginTop:"-"+l.scroll.y+"px"})
window.scrollTo(0,0),e(r).append('<div class="loader">'+t.text.loading+"</div>").fadeTo(t.duration,1,t.easeIn)
var c=e(".loader",r).css({position:"absolute",left:"50%",top:"50%",zIndex:3,margin:"-"+e(this).height()/2+"px -"+e(this).width()/2+"px"}),f=null,u=e(".close",r).hide()
if(d.ajax)var v=e.get(a,function(o){var n=e(o).find(d.content)
e(r).append('<div class="popup-content"></div>'),f=e(".popup-content",r).css({minHeight:"100%",margin:"100% auto 0",zIndex:2}).fadeTo(0,0).append(e(u).show()).append(n).fadeTo(t.duration,1,t.easeOut),d.initCallback&&d.initCallback(),e(c).fadeTo(t.duration,0,t.easeOut,function(){e(this).remove()}),e(f).animate({marginTop:"0%"},t.duration,t.easeOut)})
else{var h=e(n).parent().find(d.content).length>0?e(n).parent().find(d.content).show():e(d.content).show()
e(r).append('<div class="popup-content"></div>'),f=e(".popup-content",r).css({minHeight:"100%",margin:"100% auto 0",zIndex:2}).fadeTo(0,0).append(e(u).show()),f.p=h.parent(),f.i=h.index(),f.append(h).fadeTo(t.duration,1,t.easeOut),d.initCallback&&d.initCallback(),e(c).fadeTo(t.duration,0,t.easeOut,function(){e(this).remove()}),e(f).animate({marginTop:"0%"},t.duration,t.easeOut)}return e(s).add(u).on("click",function(){e(s).add(u).off("click"),v&&v.abort(),d.closeCallback&&d.closeCallback(),e("body")[0].style.height="",e("body")[0].style.overflow="",e("body").css({overflow:l.overflow,height:""}),e(p).children().first().unwrap(),window.scrollTo(l.scroll.x,l.scroll.y),f&&e(f).animate({marginTop:"-100%"},t.duration,t.easeIn),e(r).fadeTo(t.duration,0,t.easeIn,function(){d.ajax||(0==f.i?e(f.p).prepend(e(f.children(d.content))):e(f.p).children().eq(f.i-1).after(e(f.children(d.content).hide()))),e(s).add(u).off("click"),e(this).remove()})}),o.stopPropagation(),o.preventDefault(),!1})}})})