// popup.js
// o2web.ca
!function(a){var b=function(){var a=-1;if("Microsoft Internet Explorer"==navigator.appName){var b=navigator.userAgent,c=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=c.exec(b)&&(a=parseFloat(RegExp.$1))}return-1!=a&&10>a?a:!1}();if(!b||b>8){var c=function(){var a=window.getComputedStyle(document.documentElement,""),b=(Array.prototype.slice.call(a).join("").match(/-(moz|webkit|ms)-/)||""===a.OLink&&["","o"])[1],c="WebKit|Moz|MS|O".match(new RegExp("("+b+")","i"))[1];return{dom:c,lowercase:b,css:"-"+b+"-",js:(b[0].toUpperCase()+b.substr(1)).toLowerCase()}}(),d=function(){var a,b=!1,c=["Webkit","Moz","ms","O"],d=document.createElement("div");if(void 0!==d.style.perspective)a="",b=!0;else for(var e=0;e<c.length;++e)if(c[e]+"Perspective"in d.style){b=!0,a=c[e];break}return b}();c.js+"Transition";var f=c.js+"Transform";c.css+"transform";var h=c.css+"transition",i={start:"translate"+(d?"3d":""),end:d?", 0":""}}a.extend(a.fn,{popup:function(c){var d=a(this);d.each(function(){var d=a(this)[0]?a(this)[0]:this;d.s={},a.extend(d.s,a.extend(!0,{types:{def:{content:"body",ajax:!0,initCallback:null,closeCallback:null,overlay:{color:"#000",image:null,opacity:.8},css3:!b||b>8}},zIndex:25,duration:500,easeIn:"swing",easeOut:"swing",cssEaseIn:"cubic-bezier(0.65, 0, 0.75, 0.4)",cssEaseOut:"cubic-bezier(0.275, 0.895, 0.51, 1)",text:{loading:"Loading...",closePopup:"Close"}},c))}),a(this).on("click",function(b){var c=a(this)[0]?a(this)[0]:this,d=a(this).attr("href"),e=c.s.types[a(this).attr("popup")]?a(this).attr("popup"):"def",g=a.extend(!0,c.s.types.def,c.s.types[e]),j={scroll:{x:a(window).scrollLeft(),y:a(window).scrollTop()},overflow:a("body")[0].style.overflow};a("body").append('<div id="popup"><div class="overlay"></div><div class="close">'+c.s.text.closePopup+"</div></div>");var k=a("#popup").addClass(e).fadeTo(0,0).css({position:"fixed",top:0,bottom:0,left:0,right:0,overflow:"hidden",zIndex:c.s.zIndex}),l=a(".overlay",k).css({position:"fixed",top:0,bottom:0,left:0,right:0,background:(g.overlay.image?image+" ":"")+g.overlay.color,zIndex:0}).fadeTo(0,g.overlay.opacity);a("body").css({overflow:"hidden",height:a(window).height()+"px"}).prepend('<div class="freezed"></div>').children().not(k).appendTo(a("body>.freezed"));var m=a("body>.freezed").css({marginTop:"-"+j.scroll.y+"px"});window.scrollTo(0,0),a(k).append('<div class="loader">'+c.s.text.loading+"</div>").fadeTo(c.s.duration,1,c.s.easing);var p,n=a(".loader",k).css({position:"absolute",left:"50%",top:"50%",zIndex:3,margin:"-"+a(this).height()/2+"px -"+a(this).width()/2+"px"}),o=null,q=!1,t=a(".close",k).css({zIndex:2}).hide();if(g.ajax)var u=a.get(d,function(b){p=a(b).find(g.content).length>0?a(b).find(g.content):a(b),a(k).append('<div class="popup-content white"></div>'),o=a(".popup-content",k).css({zIndex:3}).fadeTo(0,0).append(a(t).show()).append(p).fadeTo(c.s.duration,1,c.s.easeOut),g.css3&&(a(o)[0].style[f]=i.start+"(0px,-1000px"+i.end+")"),g.initCallback&&g.initCallback(c),a(n).fadeTo(c.s.duration,0,c.s.easeOut,function(){a(this).remove()}),g.css3?(a(o).css(h,"all "+(c.s.duration+100)+"ms "+c.s.cssEaseOut),a(o)[0].style[f]=i.start+"(0px,0px"+i.end+")",setTimeout(function(){a(o).css(h,""),a(o)[0].style[f]=""},c.s.duration+100)):a(k).css("overflow","auto")});else{switch(typeof g.content){case"string":p=a(g.content),q=!0;break;case"object":g.content.attr&&(p=a(c).attr(g.content.attr)),g.content.sibling&&(p=a(a(c).siblings(g.content.sibling+"")),q=!0)}a(k).append('<div class="popup-content white"></div>'),a(k).css("overflow","hidden"),o=a(".popup-content",k).css({position:"relative",zIndex:3}).fadeTo(0,0).append(a(t).show()),q&&(o.p=p.parent(),o.p.is(".freezed")&&(o.p=a("body")),o.i=p.index()),g.css3&&(a(o)[0].style[f]=i.start+"(0px, -1000px"+i.end+")"),o.append(a(p).show()).fadeTo(c.s.duration,1,c.s.easeOut),a(n).fadeTo(c.s.duration,0,c.s.easeOut,function(){a(this).remove()}),g.css3?(a(o).css(h,"all "+(c.s.duration+100)+"ms "+c.s.cssEaseOut),a(o)[0].style[f]=i.start+"(0px,0px"+i.end+")",setTimeout(function(){a(o).css(h,""),a(o)[0].style[f]="",a(k).css("overflow","auto"),g.initCallback&&g.initCallback(c)},c.s.duration+100)):(a(k).css("overflow","auto"),g.initCallback&&g.initCallback(c))}return a(l).add(t).on("click",function(){o&&(a(l).add(t).off("click"),u&&u.abort(),g.css3&&(a(o)[0].style[f]=i.start+"(0px,0px"+i.end+")"),g.closeCallback&&g.closeCallback(c),a("body")[0].style.height="",a("body")[0].style.overflow="",a("body").css({overflow:"originalProps.overflow",height:""}),a(m).children().first().unwrap(),window.scrollTo(j.scroll.x,j.scroll.y),o&&(g.css3?(a(k).css("overflow","hidden").fadeTo(c.s.duration,0,c.s.easing),a(o).css(h,"all "+(c.s.duration+100)+"ms "+c.s.cssEaseIn),a(o)[0].style[f]=i.start+"(0px,-1000px"+i.end+")",setTimeout(function(){a(o).css(h,""),a(o)[0].style[f]="",!g.ajax&&q&&(0==o.i?a(o.p).prepend(a(p)):a(o.p).children().eq(o.i-1).after(a(p.hide()))),a(l).add(t).off("click"),a(k).remove()},c.s.duration+100)):a(k).css("overflow","hidden").fadeTo(c.s.duration,0,c.s.easing,function(){!g.ajax&&q&&(console.log("backinplace"),0==o.i?a(o.p).prepend(a(p)):a(o.p).children().eq(o.i-1).after(a(p.hide()))),a(l).add(t).off("click"),a(k).remove()})))}),b.stopPropagation(),b.preventDefault(),!1})}})}(jQuery);